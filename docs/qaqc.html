<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>17 Data Cleaning in R | Data Management and Reproducible Science</title>
<meta name="author" content="Claire S Teitelbaum">
<meta name="description" content="17.1 Objectives Fix issues related to reading data and data formatting Summarize and visualize data to identify likely errors Resolve missing data using tools in R  17.2 Principles of data...">
<meta name="generator" content="bookdown 0.43 with bs4_book()">
<meta property="og:title" content="17 Data Cleaning in R | Data Management and Reproducible Science">
<meta property="og:type" content="book">
<meta property="og:description" content="17.1 Objectives Fix issues related to reading data and data formatting Summarize and visualize data to identify likely errors Resolve missing data using tools in R  17.2 Principles of data...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="17 Data Cleaning in R | Data Management and Reproducible Science">
<meta name="twitter:description" content="17.1 Objectives Fix issues related to reading data and data formatting Summarize and visualize data to identify likely errors Resolve missing data using tools in R  17.2 Principles of data...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Management and Reproducible Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Course overview</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">2</span> Introduction: The What and Why of Reproducible Science</a></li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> Getting Started with R</a></li>
<li><a class="" href="importexport.html"><span class="header-section-number">4</span> Data Structures and Importing Data</a></li>
<li><a class="" href="troubleshooting.html"><span class="header-section-number">5</span> Troubleshooting in R</a></li>
<li><a class="" href="filter-select-mutate.html"><span class="header-section-number">6</span> Data Manipulation with R, Part 1</a></li>
<li><a class="" href="nums-chrs.html"><span class="header-section-number">7</span> Numbers, Characters, and Factors in R</a></li>
<li><a class="" href="lubridate.html"><span class="header-section-number">8</span> Dates and Times in R</a></li>
<li><a class="" href="manipulation.html"><span class="header-section-number">9</span> Data Manipulation with R, Part 2</a></li>
<li><a class="" href="style.html"><span class="header-section-number">10</span> Coding Best Practices</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">11</span> Data Visualization with ggplot2</a></li>
<li><a class="" href="data-presentation.html"><span class="header-section-number">12</span> Customizing Graphics with ggplot2</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">13</span> Creating and Designing Data Tables</a></li>
<li><a class="" href="git.html"><span class="header-section-number">14</span> Version Control with Git and GitHub</a></li>
<li><a class="" href="github.html"><span class="header-section-number">15</span> Collaboration with GitHub (or friends)</a></li>
<li><a class="" href="markdown.html"><span class="header-section-number">16</span> Reproducible Reports with R Markdown and Quarto</a></li>
<li><a class="active" href="qaqc.html"><span class="header-section-number">17</span> Data Cleaning in R</a></li>
<li><a class="" href="for-if.html"><span class="header-section-number">18</span> Iterating and Conditioning: for Loops and if Statements</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">19</span> Writing Your Own Functions</a></li>
<li><a class="" href="lists.html"><span class="header-section-number">20</span> Complex Data Structures in R</a></li>
<li><a class="" href="spatial.html"><span class="header-section-number">21</span> An Introduction to Spatial Data in R</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="qaqc" class="section level1" number="17">
<h1>
<span class="header-section-number">17</span> Data Cleaning in R<a class="anchor" aria-label="anchor" href="#qaqc"><i class="fas fa-link"></i></a>
</h1>
<div id="objectives-14" class="section level2" number="17.1">
<h2>
<span class="header-section-number">17.1</span> Objectives<a class="anchor" aria-label="anchor" href="#objectives-14"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Fix issues related to reading data and data formatting</li>
<li>Summarize and visualize data to identify likely errors</li>
<li>Resolve missing data using tools in R</li>
</ul>
</div>
<div id="principles-of-data-cleaning" class="section level2" number="17.2">
<h2>
<span class="header-section-number">17.2</span> Principles of data cleaning<a class="anchor" aria-label="anchor" href="#principles-of-data-cleaning"><i class="fas fa-link"></i></a>
</h2>
<p>Many of the tools we will use to clean data in R are functions and approaches we have already covered. Learning how to use these approaches to identify, fix, and document errors in data is a key part of a reproducible workflow. Although you <em>could</em> fix many of these issues manually in Excel, doing so programatically provides a record of your methods and changes. It also allows you to use the same approaches over and over again, with less effort each time.</p>
</div>
<div id="fixing-issues-with-data-entry-and-reading-data" class="section level2" number="17.3">
<h2>
<span class="header-section-number">17.3</span> Fixing issues with data entry and reading data<a class="anchor" aria-label="anchor" href="#fixing-issues-with-data-entry-and-reading-data"><i class="fas fa-link"></i></a>
</h2>
<p>Some errors in data come in through inconsistencies in data entry, or incompatibility of data entry with the way R reads data. One issue that you can encounter before even getting data into R deals with special characters (i.e., symbols). Some of these have to be <a href="https://kunststube.net/encoding/">“encoded,”</a> meaning that they are replaced by a code rather than read in as the symbol itself. For the most part, this is for symbols that aren’t on your keyboard, like Greek letters and (in this case) the degree sign.</p>
<div class="sourceCode" id="cb511"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<pre><code>## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.4     ✔ readr     2.1.5
## ✔ forcats   1.0.0     ✔ stringr   1.5.1
## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
## ✔ purrr     1.0.2     
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<div class="sourceCode" id="cb513"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/raw/messy_georgia_fish_data.csv"</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## Error in type.convert.default(data[[i]], as.is = as.is[i], dec = dec, : invalid multibyte string at '&lt;a1&gt;07'&lt;35&gt;9.2"N, 84&lt;a1&gt;37'27.8"W'</code></pre>
<p>We can change the encoding that R expects with an additional argument:</p>
<div class="sourceCode" id="cb515"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/raw/messy_georgia_fish_data.csv"</span>, fileEncoding <span class="op">=</span> <span class="st">"latin1"</span><span class="op">)</span> </span></code></pre></div>
<p>In this case, I usually find it easiest to play around with the encoding options until something works - it’s more work to figure out the encoding in the original file, and that information is sometimes unavailable.</p>
<div id="column-names" class="section level3" number="17.3.1">
<h3>
<span class="header-section-number">17.3.1</span> Column names<a class="anchor" aria-label="anchor" href="#column-names"><i class="fas fa-link"></i></a>
</h3>
<p>R has a few rules for column names: they cannot contain spaces or symbols and cannot start with numbers. If you read in a data file with these characteristics, R will do its best to fix them - but not usually in the way you would like. In this case <code>read_csv</code> and <code>read.csv</code> act differently: <code>read_csv</code> creates a tibble, which can handle spaces, symbols, and numbers as long as they are referenced in tick marks (<code></code>), but <code>read.csv</code> will rename your columns.</p>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/raw/messy_georgia_fish_data.csv"</span>, fileEncoding <span class="op">=</span> <span class="st">"latin1"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fish_base</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "Sample.ID"        "Common.Name"      "Scientific.Name"  "Fish.Length..mm."
##  [5] "Date.Collected"   "Sample.Location"  "Coordinates"      "X1st.Method.Used"
##  [9] "X2nd.Method.Used" "Notes"</code></pre>
<div class="sourceCode" id="cb518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/raw/messy_georgia_fish_data.csv"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Rows: 52 Columns: 10
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (8): Common Name, Scientific Name, Date Collected, Sample Location, Coor...
## dbl (2): Sample ID, Fish Length (mm)
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fish_in</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "Sample ID"        "Common Name"      "Scientific Name"  "Fish Length (mm)"
##  [5] "Date Collected"   "Sample Location"  "Coordinates"      "1st Method Used" 
##  [9] "2nd Method Used"  "Notes"</code></pre>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="qaqc.html#cb522-1" tabindex="-1"></a><span class="fu">head</span>(fish_in<span class="sc">$</span><span class="dv">1</span>st Method Used) <span class="co">#returns an error</span></span></code></pre></div>
<div class="sourceCode" id="cb523"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fish_in</span><span class="op">$</span><span class="va">`1st Method Used`</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] NA              "Seine"         "Trawl"         "Seine"        
## [5] NA              "Hook and line"</code></pre>
<p><em>Side note: Notice that I did not need to include the encoding in <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code>. This is because it’s a little more likely than <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> to figure out the encoding by default.</em></p>
<p>Although <code>read_csv</code> works a little better here, it’s still annoying to access columns with ticks, and they won’t work in all functions. The <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> function in <code>dplyr</code> becomes useful here. The <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with()</a></code> function allows us to rename multiple columns using a rule:</p>
<div class="sourceCode" id="cb525"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">fish_in</span>, Method1 <span class="op">=</span> <span class="va">`1st Method Used`</span>,</span>
<span>               Method2 <span class="op">=</span> <span class="va">`2nd Method Used`</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fish</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "Sample ID"        "Common Name"      "Scientific Name"  "Fish Length (mm)"
##  [5] "Date Collected"   "Sample Location"  "Coordinates"      "Method1"         
##  [9] "Method2"          "Notes"</code></pre>
<div class="sourceCode" id="cb527"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="va">fish</span>, <span class="op">~</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">" "</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="va">fish</span>, <span class="op">~</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"[)]|[(]"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fish</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "Sample_ID"       "Common_Name"     "Scientific_Name" "Fish_Length_mm" 
##  [5] "Date_Collected"  "Sample_Location" "Coordinates"     "Method1"        
##  [9] "Method2"         "Notes"</code></pre>
<p>The syntax of the <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with()</a></code> function introduces a couple of new ways of working with <code>tidyverse</code> functions. Often, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code>, and so on expect a function as their second argument. The function is preceded by a tilde (~) and using <code>.x</code> as an argument tells R to use column names.</p>
<p>Also note that I renamed my data from <code>fish_in</code> to <code>fish</code>. This can help you if you want to compare your clean and raw data later.</p>
<p>We might also want to follow general best practices and get rid of capital letters:</p>
<div class="sourceCode" id="cb529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="va">fish</span>, <span class="va">str_to_lower</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">fish</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "sample_id"       "common_name"     "scientific_name" "fish_length_mm" 
##  [5] "date_collected"  "sample_location" "coordinates"     "method1"        
##  [9] "method2"         "notes"</code></pre>
<p>This is another way of using these functions. If they don’t require any other arguments, we can just include the function name (without a ~). The code above is the same as:</p>
<div class="sourceCode" id="cb531"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span><span class="va">fish</span>, <span class="op">~</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="multi-format-columns" class="section level3" number="17.3.2">
<h3>
<span class="header-section-number">17.3.2</span> Multi-format columns<a class="anchor" aria-label="anchor" href="#multi-format-columns"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes, data are entered in such a way that R cannot tell the appropriate format. In this case, you will most often end up with a character column because almost anything can be converted to a character without losing information. We can check the format of the columns using <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> or <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> from tidyverse.</p>
<div class="sourceCode" id="cb532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">fish</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Rows: 52
## Columns: 10
## $ sample_id       &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 11, 14, 15,…
## $ common_name     &lt;chr&gt; "Bluegill", "Brown Bullhead", "Redbreast Sunfish", "Re…
## $ scientific_name &lt;chr&gt; "Lepomis macrochirus", "Ameiurus nebulosus", "Lepomis …
## $ fish_length_mm  &lt;dbl&gt; NA, 160, 9999, 9999, 201, 521, 9999, 9999, 750, 10000,…
## $ date_collected  &lt;chr&gt; "10/4/24", "10/4/24", "10/4/24", "10/4/24", "10/4/24",…
## $ sample_location &lt;chr&gt; "?", NA, "Lake Allatoona", NA, "Chattahoochee@CRNRA", …
## $ coordinates     &lt;chr&gt; NA, NA, "34\xa107'59.2\"N, 84\xa137'27.8\"W", NA, "33\…
## $ method1         &lt;chr&gt; NA, "Seine", "Trawl", "Seine", NA, "Hook and line", "H…
## $ method2         &lt;chr&gt; "Gill net", "Gill net", "Trawl", "Gill net", "Hook and…
## $ notes           &lt;chr&gt; "Unknown location", NA, NA, NA, NA, NA, NA, NA, NA, NA…</code></pre>
<p>It looks like we have problems with two columns: <strong>date_collected</strong> should be a date and <em>coordinates</em> should really be two columns (latitude and longitude). Just looking at the first few elements of date_collected, it looks like it’s all in a month/day/year format, so let’s try that:</p>
<div class="sourceCode" id="cb534"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">fish</span>, date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="va">date_collected</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `date = mdy(date_collected)`.
## Caused by warning:
## !  25 failed to parse.</code></pre>
<div class="sourceCode" id="cb536"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 30</code></pre>
<p>The warning tells us that 25 of the elements were not in month/day/year format. Let’s look at that in more detail:</p>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">date_collected</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "10/4/24"    "7/5/24"     "19-Jun-24"  "6/4/24"     "6/17/24"   
##  [6] "25-Jun-24"  "4/27/24"    NA           "5/21/24"    "29/06/2024"
## [11] "6/29/24"    "4/29/24"    "24-Apr-24"  "6-May-24"   "4/5/24"    
## [16] "22/05/2024" "5/23/24"    "9/4/24"     "28/05/2024" "4-Apr-24"  
## [21] "8-May-24"   "10-Apr-24"  "22/06/2024" "2-Jun-24"   "30/05/2024"
## [26] "16/05/2024" "5/29/24"    "15-May-24"  "18-Jun-24"  "4/21/24"   
## [31] "28/04/2024" "26-Jun-24"  "12/6/24"    "5/28/24"    "19/06/2024"
## [36] "13-Apr-24"</code></pre>
<p>It looks like we have a few formats. Luckily, <code>lubridate</code> treats names of months as the same as their numbers, so we don’t have to worry about that. Here is where <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> comes in. Since <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy()</a></code> returns <code>NA</code> if it can’t parse a date, we can take advantage of that:</p>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">fish</span>, date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="va">date_collected</span><span class="op">)</span>,</span>
<span>               date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="va">date_collected</span><span class="op">)</span>, <span class="va">date</span><span class="op">)</span>,</span>
<span>               date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="va">date_collected</span><span class="op">)</span>, <span class="va">date</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: There were 3 warnings in `mutate()`.
## The first warning was:
## ℹ In argument: `date = mdy(date_collected)`.
## Caused by warning:
## !  25 failed to parse.
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 2 remaining warnings.</code></pre>
<div class="sourceCode" id="cb542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<p>The logic here is that we first use one method to parse dates. If that doesn’t work, we use another - but we only apply this to dates where the first method returned <code>NA</code>, and we source the date to parse from the original date column. We still get a lot of warnings because we have to go through the <code>NA</code>s. We also still have five <code>NA</code>s, but looking at those more closely, they all had missing dates in the original data:</p>
<div class="sourceCode" id="cb544"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date_collected</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 1
##   date_collected
##   &lt;chr&gt;         
## 1 &lt;NA&gt;          
## 2 &lt;NA&gt;          
## 3 &lt;NA&gt;          
## 4 &lt;NA&gt;          
## 5 &lt;NA&gt;</code></pre>
</div>
<div id="strings-and-special-characters" class="section level3" number="17.3.3">
<h3>
<span class="header-section-number">17.3.3</span> Strings and special characters<a class="anchor" aria-label="anchor" href="#strings-and-special-characters"><i class="fas fa-link"></i></a>
</h3>
<p>The coordinates column highlights another issue: while R read in the special character (degree symbol) eventually, it doesn’t look right and doesn’t provide us with information here; we don’t usually include units within our data.</p>
<div class="sourceCode" id="cb546"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">coordinates</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] NA                                    
## [2] NA                                    
## [3] "34\xa107'59.2\"N, 84\xa137'27.8\"W"  
## [4] NA                                    
## [5] "33\xa159'12.48\"N, 84\xa119'25.32\"W"
## [6] "34\xa1 7'59.16\"N, 84\xa137'27.84\"W"</code></pre>
<p>The coordinates also appear to be in a combination of degrees-minutes-seconds format rather than in decimal degrees. Here, we need to split latitude and longitude, split apart the components, and then use them to calculate decimal degrees:</p>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>latitude <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split_fixed</a></span><span class="op">(</span><span class="va">coordinates</span>, pattern <span class="op">=</span> <span class="st">","</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>         longitude <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split_fixed</a></span><span class="op">(</span><span class="va">coordinates</span>, <span class="st">","</span>, <span class="fl">2</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">fish</span>, <span class="va">latitude</span>, <span class="va">longitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   latitude            longitude           
##   &lt;chr&gt;               &lt;chr&gt;               
## 1  &lt;NA&gt;               ""                  
## 2  &lt;NA&gt;               ""                  
## 3 "34\xa107'59.2\"N"  " 84\xa137'27.8\"W" 
## 4  &lt;NA&gt;               ""                  
## 5 "33\xa159'12.48\"N" " 84\xa119'25.32\"W"
## 6 "34\xa1 7'59.16\"N" " 84\xa137'27.84\"W"</code></pre>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latitudes</span> <span class="op">&lt;-</span> <span class="va">fish</span><span class="op">$</span><span class="va">latitude</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#split by degree symbol and minutes symbol</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split_fixed</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"\xa1|'|\""</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#convert from matrix to tibble and rename</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"deg"</span>,<span class="st">"min"</span>,<span class="st">"sec"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if
## `.name_repair` is omitted as of tibble 2.0.0.
## ℹ Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latitudes</span> <span class="op">&lt;-</span> <span class="va">latitudes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#remove north designation and seconds symbol</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"N|\""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#convert strings to numeric</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#convert to decimal degrees</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dd <span class="op">=</span> <span class="va">deg</span> <span class="op">+</span> <span class="va">min</span><span class="op">/</span><span class="fl">60</span> <span class="op">+</span> <span class="va">sec</span><span class="op">/</span><span class="op">(</span><span class="fl">60</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">longitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split_fixed</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">longitude</span>, pattern <span class="op">=</span> <span class="st">"\xa1|'|\""</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"deg"</span>,<span class="st">"min"</span>,<span class="st">"sec"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">longitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">longitudes</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"W|\""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dd <span class="op">=</span> <span class="va">deg</span> <span class="op">+</span> <span class="va">min</span><span class="op">/</span><span class="fl">60</span> <span class="op">+</span> <span class="va">sec</span><span class="op">/</span><span class="op">(</span><span class="fl">60</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">fish</span>, lat <span class="op">=</span> <span class="va">latitudes</span><span class="op">$</span><span class="va">dd</span>, long <span class="op">=</span> <span class="va">longitudes</span><span class="op">$</span><span class="va">dd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">coordinates</span>, <span class="va">lat</span>, <span class="va">long</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   coordinates                              lat  long
##   &lt;chr&gt;                                  &lt;dbl&gt; &lt;dbl&gt;
## 1  &lt;NA&gt;                                   NA    NA  
## 2  &lt;NA&gt;                                   NA    NA  
## 3 "34\xa107'59.2\"N, 84\xa137'27.8\"W"    34.1  84.6
## 4  &lt;NA&gt;                                   NA    NA  
## 5 "33\xa159'12.48\"N, 84\xa119'25.32\"W"  34.0  84.3
## 6 "34\xa1 7'59.16\"N, 84\xa137'27.84\"W"  34.1  84.6</code></pre>
<p>That was a <em>lot</em> of steps. There’s probably a package out there that would do it for you, but if you know the basics it can be faster to use them than to figure out the syntax of new functions.</p>
</div>
</div>
<div id="identifying-likely-errors" class="section level2" number="17.4">
<h2>
<span class="header-section-number">17.4</span> Identifying likely errors<a class="anchor" aria-label="anchor" href="#identifying-likely-errors"><i class="fas fa-link"></i></a>
</h2>
<p>Now that the data are formatted correctly, we still need to make sure the data points themselves are valid. Two main flavors of incorrect data are duplicates and incorrect entries (sometimes called outliers).</p>
<div id="duplicates" class="section level3" number="17.4.1">
<h3>
<span class="header-section-number">17.4.1</span> Duplicates<a class="anchor" aria-label="anchor" href="#duplicates"><i class="fas fa-link"></i></a>
</h3>
<p>A duplicate is just that: a piece of data that has been entered twice. <em>True duplicates</em> are data points that share all the same information. They make our lives easy because they are the same - we just need to identify them and remove one. Other duplicates are more ambiguous; for example, I sometimes come across GPS locations from a single animal that have the same timestamp with different coordinates. In this case, we can look at the values to see which is more likely (see “outliers” below) or randomly choose one.</p>
<p>To check for duplicates, we can use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>:</p>
<div class="sourceCode" id="cb554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#use all columns as groups</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#count the number in each group</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="co">#filter to groups with more than one entry</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'sample_id', 'common_name',
## 'scientific_name', 'fish_length_mm', 'date_collected', 'sample_location',
## 'coordinates', 'method1', 'method2', 'notes', 'date', 'latitude', 'longitude',
## 'lat'. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 1 × 16
## # Groups:   sample_id, common_name, scientific_name, fish_length_mm,
## #   date_collected, sample_location, coordinates, method1, method2, notes,
## #   date, latitude, longitude, lat [1]
##   sample_id common_name scientific_name     fish_length_mm date_collected
##       &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;                        &lt;dbl&gt; &lt;chr&gt;         
## 1        11 Bluegill    Lepomis macrochirus            108 4/27/24       
## # ℹ 11 more variables: sample_location &lt;chr&gt;, coordinates &lt;chr&gt;, method1 &lt;chr&gt;,
## #   method2 &lt;chr&gt;, notes &lt;chr&gt;, date &lt;date&gt;, latitude &lt;chr&gt;, longitude &lt;chr&gt;,
## #   lat &lt;dbl&gt;, long &lt;dbl&gt;, n &lt;int&gt;</code></pre>
<p>Here, we know that the data are identical, so we can just take the first of these rows:</p>
<div class="sourceCode" id="cb557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#use all columns as groups</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co">#take the first item in each group</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">fish_in</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">fish</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>I have removed one row.</p>
<p>If there are any other columns that should be unique identifiers, I can use them here. For example, I think there should only be one row per sample ID.</p>
<div class="sourceCode" id="cb559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#use only sample ID as group</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#count the number in each group</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="co">#filter to groups with more than one entry</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   sample_id     n
##       &lt;dbl&gt; &lt;int&gt;
## 1        21     2</code></pre>
<p>Let’s look at that sample:</p>
<div class="sourceCode" id="cb561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="fl">21</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 2 × 15
## # Groups:   sample_id, common_name, scientific_name, fish_length_mm,
## #   date_collected, sample_location, coordinates, method1, method2, notes,
## #   date, latitude, longitude, lat, long [2]
##   sample_id common_name scientific_name fish_length_mm date_collected
##       &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;                    &lt;dbl&gt; &lt;chr&gt;         
## 1        21 Warmouth    Lepomis gulosus            174 22/05/2024    
## 2        21 Warmouth    Lepomis gulosus            174 22/05/2024    
## # ℹ 10 more variables: sample_location &lt;chr&gt;, coordinates &lt;chr&gt;, method1 &lt;chr&gt;,
## #   method2 &lt;chr&gt;, notes &lt;chr&gt;, date &lt;date&gt;, latitude &lt;chr&gt;, longitude &lt;chr&gt;,
## #   lat &lt;dbl&gt;, long &lt;dbl&gt;</code></pre>
<p>We can look at which columns differ:</p>
<div class="sourceCode" id="cb563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="fl">21</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#group by sample ID</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">n_distinct</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#get the number of unique values in each column</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">sample_id</span><span class="op">)</span> <span class="co">#pivot_longer just turns this into columns for visualization</span></span></code></pre></div>
<pre><code>## # A tibble: 14 × 3
##    sample_id name            value
##        &lt;dbl&gt; &lt;chr&gt;           &lt;int&gt;
##  1        21 common_name         1
##  2        21 scientific_name     1
##  3        21 fish_length_mm      1
##  4        21 date_collected      1
##  5        21 sample_location     1
##  6        21 coordinates         1
##  7        21 method1             2
##  8        21 method2             1
##  9        21 notes               1
## 10        21 date                1
## 11        21 latitude            1
## 12        21 longitude           1
## 13        21 lat                 1
## 14        21 long                1</code></pre>
<p>It looks like method1 is our problem:</p>
<div class="sourceCode" id="cb565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="fl">21</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">method1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Electrofishing" "electrofishing"</code></pre>
<p>We have a capitalization problem! While we’re at it, why don’t we make sure that is fixed for all character columns:</p>
<div class="sourceCode" id="cb567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>common_name <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="va">common_name</span><span class="op">)</span>,</span>
<span>         scientific_name <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_sentence</a></span><span class="op">(</span><span class="va">scientific_name</span><span class="op">)</span>,</span>
<span>         sample_location <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="va">sample_location</span><span class="op">)</span>,</span>
<span>         method1 <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="va">method1</span><span class="op">)</span>,</span>
<span>         method2 <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="va">method2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can remove that final duplicate:</p>
<div class="sourceCode" id="cb568"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#use all columns as groups</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#take the first item in each group</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">fish_in</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">fish</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 2</code></pre>
</div>
<div id="outliers" class="section level3" number="17.4.2">
<h3>
<span class="header-section-number">17.4.2</span> Outliers<a class="anchor" aria-label="anchor" href="#outliers"><i class="fas fa-link"></i></a>
</h3>
<p>For quantitative variables, outliers are values outside the expected range of the data. Some outliers are true data - for example, an organism that is very large or very small for its species - but some are due to errors in data entry, instrumentation, or sampling. For example, a juvenile might have been measured in a sample that was supposed to only be adults. To identify outliers, we can look at the range and distributions of our numeric variables. In the fish dataset, we only have one numeric variable: fish length.</p>
<div class="sourceCode" id="cb570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">fish_length_mm</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1]    27 10000</code></pre>
<div class="sourceCode" id="cb572"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">fish_length_mm</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="data-cleaning_files/figure-html/unnamed-chunk-25-1.png" width="672"></div>
<p>It looks like we have a bunch of lengths that are way too long to be reasonable. Let’s look at those values:</p>
<div class="sourceCode" id="cb573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish_length_mm</span> <span class="op">&gt;</span> <span class="fl">6000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">fish_length_mm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1]  9999 10000</code></pre>
<p>We see there are two outliers here: 9,999 and 10,000. 9999 is a common code for missing data, so we probably want to replace those with NAs. 10,000 is probably an error in data entry. Let’s convert those all to NAs:</p>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fish_length_mm <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">fish_length_mm</span> <span class="op">&gt;</span> <span class="fl">6000</span>, <span class="cn">NA</span>, <span class="va">fish_length_mm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">fish_length_mm</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="data-cleaning_files/figure-html/unnamed-chunk-27-1.png" width="672"></div>
<p>That looks better.</p>
<p>Sometimes these errors can be corrected. For example, if we were sure that the 10000 was supposed to be entered as 100.00, we could replace that value:</p>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fish_length_mm <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">fish_length_mm</span> <span class="op">==</span> <span class="fl">10000</span>, <span class="fl">100</span>, <span class="va">fish_length_mm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In non-numeric data, the equivalent of an outlier is an unexpected value. The easiest way to look at this can be by listing the unique values of a vector/column:</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">fish</span><span class="op">$</span><span class="va">sample_location</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "?"                   NA                    "Lake Allatoona"     
## [4] "Chattahoochee@Crnra" "Satilla River"       "Flint River"        
## [7] "Lake Lanier"         "Chattahoochee River" "Ocmulgee River"</code></pre>
<p>Here, we probably want to replace “?” with <code>NA</code>.</p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sample_location <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">sample_location</span> <span class="op">==</span> <span class="st">"?"</span>, <span class="cn">NA</span>, <span class="va">sample_location</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="dealing-with-missing-data" class="section level2" number="17.5">
<h2>
<span class="header-section-number">17.5</span> Dealing with missing data<a class="anchor" aria-label="anchor" href="#dealing-with-missing-data"><i class="fas fa-link"></i></a>
</h2>
<p>Most ecological data sets contain some missing data. There are three main ways to deal with this.</p>
<div id="filtering" class="section level3" number="17.5.1">
<h3>
<span class="header-section-number">17.5.1</span> Filtering<a class="anchor" aria-label="anchor" href="#filtering"><i class="fas fa-link"></i></a>
</h3>
<p>The most obvious way to deal with missing data is to ignore data points that are missing. When doing so, a key question to ask yourself is which missing data matter. For example, if we are not using spatial data, missing coordinates will not matter. The <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function combined with <code><a href="https://dplyr.tidyverse.org/reference/across.html">if_any()</a></code> or <code><a href="https://dplyr.tidyverse.org/reference/across.html">if_all()</a></code> is your friend here. For example, we might only want to filter data if length is missing:</p>
<div class="sourceCode" id="cb580"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish_len_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fish_length_mm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Or if all the location columns are complete:</p>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish_loc_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">if_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sample_location</span>, <span class="va">long</span>, <span class="va">lat</span><span class="op">)</span>, <span class="op">~</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Equivalent to:</span></span>
<span><span class="va">fish_loc_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish</span>, <span class="op">!</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">if_any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sample_location</span>, <span class="va">long</span>, <span class="va">lat</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The code above can be a little confusing. In the first option, we are asking for the case in which <em>all</em> of the location columns are <em>not NA</em>. In the second option, we are asking for the case in which it is <em>not</em> true that <em>any</em> of hte location columns are NA. Take a close look and see if you can figure out the logic. Sometimes this kind of backwards thinking is necessary for filtering.</p>
<p>An easier, but less streamlined alternative is:</p>
<div class="sourceCode" id="cb582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish_loc_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sample_location</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>                              <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">long</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>                              <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="imputing" class="section level3" number="17.5.2">
<h3>
<span class="header-section-number">17.5.2</span> Imputing<a class="anchor" aria-label="anchor" href="#imputing"><i class="fas fa-link"></i></a>
</h3>
<p>Like in our example of <code>fish_length_mm == 10000</code> above, you might know the reason for some missing values, allowing you to impute them (i.e., artificially add them to the dataset). You might also be able to use other data in the dataset to figure it out. For example, here we have some missing coordinates where we have location names:</p>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">fish</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">long</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sample_location</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sample_location</span>, <span class="va">coordinates</span>, <span class="va">lat</span>, <span class="va">long</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   sample_location     coordinates   lat  long
##   &lt;chr&gt;               &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 Chattahoochee@Crnra &lt;NA&gt;           NA    NA
## 2 Chattahoochee@Crnra &lt;NA&gt;           NA    NA</code></pre>
<p>But since we have coordinates for that location name elsewhere, we can impute it. First, we should make sure this location name has only one lat/long associated:</p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crnra_coords</span> <span class="op">&lt;-</span> <span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sample_location</span> <span class="op">==</span> <span class="st">"Chattahoochee@Crnra"</span> <span class="op">&amp;</span></span>
<span>           <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">long</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">long</span>, <span class="va">lat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">crnra_coords</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb587"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="va">fish</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">sample_location</span> <span class="op">==</span> <span class="st">"Chattahoochee@Crnra"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>, <span class="va">crnra_coords</span><span class="op">$</span><span class="va">lat</span>, <span class="va">lat</span><span class="op">)</span>,</span>
<span>         long <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">sample_location</span> <span class="op">==</span> <span class="st">"Chattahoochee@Crnra"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">long</span><span class="op">)</span>, <span class="va">crnra_coords</span><span class="op">$</span><span class="va">long</span>, <span class="va">long</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Depending on why the data are missing and how they will be used, other methods for imputing data include:</p>
<ul>
<li>Predictions from a model</li>
<li>Averages from the rest of the data set</li>
<li>Proxies based on other measurements</li>
</ul>
</div>
</div>
<div id="saving-clean-data" class="section level2" number="17.6">
<h2>
<span class="header-section-number">17.6</span> Saving clean data<a class="anchor" aria-label="anchor" href="#saving-clean-data"><i class="fas fa-link"></i></a>
</h2>
<p>Finally, after our data is clean, we save a new version of it in the “clean” data folder.</p>
<div class="sourceCode" id="cb588"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">fish</span>, <span class="st">"data/clean/georgia_fish_data_clean.csv"</span><span class="op">)</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="markdown.html"><span class="header-section-number">16</span> Reproducible Reports with R Markdown and Quarto</a></div>
<div class="next"><a href="for-if.html"><span class="header-section-number">18</span> Iterating and Conditioning: for Loops and if Statements</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#qaqc"><span class="header-section-number">17</span> Data Cleaning in R</a></li>
<li><a class="nav-link" href="#objectives-14"><span class="header-section-number">17.1</span> Objectives</a></li>
<li><a class="nav-link" href="#principles-of-data-cleaning"><span class="header-section-number">17.2</span> Principles of data cleaning</a></li>
<li>
<a class="nav-link" href="#fixing-issues-with-data-entry-and-reading-data"><span class="header-section-number">17.3</span> Fixing issues with data entry and reading data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#column-names"><span class="header-section-number">17.3.1</span> Column names</a></li>
<li><a class="nav-link" href="#multi-format-columns"><span class="header-section-number">17.3.2</span> Multi-format columns</a></li>
<li><a class="nav-link" href="#strings-and-special-characters"><span class="header-section-number">17.3.3</span> Strings and special characters</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#identifying-likely-errors"><span class="header-section-number">17.4</span> Identifying likely errors</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#duplicates"><span class="header-section-number">17.4.1</span> Duplicates</a></li>
<li><a class="nav-link" href="#outliers"><span class="header-section-number">17.4.2</span> Outliers</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dealing-with-missing-data"><span class="header-section-number">17.5</span> Dealing with missing data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#filtering"><span class="header-section-number">17.5.1</span> Filtering</a></li>
<li><a class="nav-link" href="#imputing"><span class="header-section-number">17.5.2</span> Imputing</a></li>
</ul>
</li>
<li><a class="nav-link" href="#saving-clean-data"><span class="header-section-number">17.6</span> Saving clean data</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Management and Reproducible Science</strong>" was written by Claire S Teitelbaum. It was last built on 2025-09-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
