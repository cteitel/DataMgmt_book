<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>9 Data Manipulation with R, Part 2 | Data Management and Reproducible Science</title>
<meta name="author" content="Claire S Teitelbaum">
<meta name="description" content="Much of this lesson draws from The Carpentries’ Data Analysis and Visualization in R for Ecologists workshop, which is published under a CC-BY 4.0 license.  9.1 Objectives Be able to use a...">
<meta name="generator" content="bookdown 0.43 with bs4_book()">
<meta property="og:title" content="9 Data Manipulation with R, Part 2 | Data Management and Reproducible Science">
<meta property="og:type" content="book">
<meta property="og:description" content="Much of this lesson draws from The Carpentries’ Data Analysis and Visualization in R for Ecologists workshop, which is published under a CC-BY 4.0 license.  9.1 Objectives Be able to use a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="9 Data Manipulation with R, Part 2 | Data Management and Reproducible Science">
<meta name="twitter:description" content="Much of this lesson draws from The Carpentries’ Data Analysis and Visualization in R for Ecologists workshop, which is published under a CC-BY 4.0 license.  9.1 Objectives Be able to use a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Management and Reproducible Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Course overview</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">2</span> Introduction: The What and Why of Reproducible Science</a></li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> Getting Started with R</a></li>
<li><a class="" href="importexport.html"><span class="header-section-number">4</span> Data Structures and Importing Data</a></li>
<li><a class="" href="troubleshooting.html"><span class="header-section-number">5</span> Troubleshooting in R</a></li>
<li><a class="" href="filter-select-mutate.html"><span class="header-section-number">6</span> Data Manipulation with R, Part 1</a></li>
<li><a class="" href="nums-chrs.html"><span class="header-section-number">7</span> Numbers, Characters, and Factors in R</a></li>
<li><a class="" href="lubridate.html"><span class="header-section-number">8</span> Dates and Times in R</a></li>
<li><a class="active" href="manipulation.html"><span class="header-section-number">9</span> Data Manipulation with R, Part 2</a></li>
<li><a class="" href="style.html"><span class="header-section-number">10</span> Coding Best Practices</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">11</span> Data Visualization with ggplot2</a></li>
<li><a class="" href="data-presentation.html"><span class="header-section-number">12</span> Customizing Graphics with ggplot2</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">13</span> Creating and Designing Data Tables</a></li>
<li><a class="" href="git.html"><span class="header-section-number">14</span> Version Control with Git and GitHub</a></li>
<li><a class="" href="github.html"><span class="header-section-number">15</span> Collaboration with GitHub (or friends)</a></li>
<li><a class="" href="markdown.html"><span class="header-section-number">16</span> Reproducible Reports with R Markdown and Quarto</a></li>
<li><a class="" href="qaqc.html"><span class="header-section-number">17</span> Data Cleaning in R</a></li>
<li><a class="" href="for-if.html"><span class="header-section-number">18</span> Iterating and Conditioning: for Loops and if Statements</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">19</span> Writing Your Own Functions</a></li>
<li><a class="" href="lists.html"><span class="header-section-number">20</span> Complex Data Structures in R</a></li>
<li><a class="" href="spatial.html"><span class="header-section-number">21</span> An Introduction to Spatial Data in R</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="manipulation" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Data Manipulation with R, Part 2<a class="anchor" aria-label="anchor" href="#manipulation"><i class="fas fa-link"></i></a>
</h1>
<p>Much of this lesson draws from The Carpentries’ <a href="https://datacarpentry.github.io/R-ecology-lesson/index.html">Data Analysis and Visualization in R for Ecologists</a> workshop, which is published under a <a href="https://datacarpentry.github.io/R-ecology-lesson/LICENSE.html">CC-BY 4.0</a> license.</p>
<div id="objectives-6" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Objectives<a class="anchor" aria-label="anchor" href="#objectives-6"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Be able to use a split-apply-combine approach to summarize data sets</li>
<li>Understand how to augment datasets, both by adding observations and by adding variables</li>
<li>Understand different types of joins and relates</li>
</ul>
</div>
<div id="additional-reading-6" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> Additional reading<a class="anchor" aria-label="anchor" href="#additional-reading-6"><i class="fas fa-link"></i></a>
</h2>
<p>Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund. R for Data Science (2e). Chapter 3: Data transformation, sections 3.5-3.7. Available: <a href="https://r4ds.hadley.nz/data-transform.html" class="uri">https://r4ds.hadley.nz/data-transform.html</a></p>
<p>Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund. R for Data Science (2e). Chapter 5: Data tidying. Available: <a href="https://r4ds.hadley.nz/data-transform.html" class="uri">https://r4ds.hadley.nz/data-transform.html</a></p>
</div>
<div id="grouping-and-summarizing-data" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> Grouping and summarizing data<a class="anchor" aria-label="anchor" href="#grouping-and-summarizing-data"><i class="fas fa-link"></i></a>
</h2>
<p>One of the most common tasks in data exploration is summarizing data. For example, we might want to know the mean of a response variable across a treatment, or how many samples were taken on a given day, and so on. <code>dplyr</code> allows us to easily summarize data by combining the functions <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>. For example:</p>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<pre><code>## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.4     ✔ readr     2.1.5
## ✔ forcats   1.0.0     ✔ stringr   1.5.1
## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
## ✔ purrr     1.0.2     
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/raw/Murray-Sanchez_urban-wildlife.csv"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Rows: 516 Columns: 42
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (14): TITLE, AUTHORS, JOURNAL, health, condition, toxtype, ptype, stress...
## dbl (28): study, YEAR, SAMPLE_SIZE, EFFECT_DIRECTION, pval, r, yi, vi, rlowe...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">host.class</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">r</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   host.class     mean_r     n
##   &lt;chr&gt;           &lt;dbl&gt; &lt;int&gt;
## 1 birds         -0.141    159
## 2 fish          -0.216     92
## 3 herpetofauna  -0.137     27
## 4 invertebrates -0.400     43
## 5 mammals        0.0232   195</code></pre>
<p>We end up with a mean value of <em>r</em> for each host group and the number of records in that group. A common function you will use when grouping is <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code>, which gives the current group size. Other common summary functions include:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct()</a></code>, which gives the number of unique values in a group and takes a column name as its argument;</li>
<li>quantitative summaries, like <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>, <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>, and <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>;</li>
</ul>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">host.class</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">r</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, n_studies <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">study</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
##   host.class     mean_r     n n_studies
##   &lt;chr&gt;           &lt;dbl&gt; &lt;int&gt;     &lt;int&gt;
## 1 birds         -0.141    159        46
## 2 fish          -0.216     92         8
## 3 herpetofauna  -0.137     27         8
## 4 invertebrates -0.400     43        10
## 5 mammals        0.0232   195        35</code></pre>
</div>
<div id="combining-and-augmenting-data-sets" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> Combining and augmenting data sets<a class="anchor" aria-label="anchor" href="#combining-and-augmenting-data-sets"><i class="fas fa-link"></i></a>
</h2>
<p>Often, we have multiple data sets that relate to each other in one way or another, or we want to combine multiple sources of the same data. For example, we might have separate data sheets from multiple field seasons and want to combine them. Or, we might have one data table that describes characteristics of plots and one that describes characteristics of trees, and we want to add the plot information for each tree.</p>
<div id="binding-rows-and-columns" class="section level3" number="9.4.1">
<h3>
<span class="header-section-number">9.4.1</span> Binding rows and columns<a class="anchor" aria-label="anchor" href="#binding-rows-and-columns"><i class="fas fa-link"></i></a>
</h3>
<p>Adding (“binding”) rows and columns is the easiest way to add data to a data frame. For example, if we have two separate data sets, we can add more rows with <code>bind_rows</code>:</p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, observer <span class="op">=</span> <span class="st">"Me"</span>, n_obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>, date <span class="op">=</span> <span class="st">"2024-04-01"</span><span class="op">)</span></span>
<span><span class="va">ds2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, observer <span class="op">=</span> <span class="st">"You"</span>, n_obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>, date <span class="op">=</span> <span class="st">"2025-01-01"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ds_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">ds1</span>, <span class="va">ds2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ds_full</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ds_full</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   plot observer n_obs       date
## 1    1       Me    37 2024-04-01
## 2    2       Me    35 2024-04-01
## 3    3       Me     2 2024-04-01
## 4    4       Me    92 2024-04-01
## 5    5       Me    53 2024-04-01
## 6    6       Me    97 2024-04-01</code></pre>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">ds_full</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    plot observer n_obs       date
## 15    5      You    52 2025-01-01
## 16    6      You    69 2025-01-01
## 17    7      You    55 2025-01-01
## 18    8      You    38 2025-01-01
## 19    9      You     6 2025-01-01
## 20   10      You     7 2025-01-01</code></pre>
<p><code>bind_rows</code> looks for column names to know how to match up the data. This is great when your columns are in different orders, but be careful with column names:</p>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, observer <span class="op">=</span> <span class="st">"Me"</span>, n_obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ds2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Plot <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, obs <span class="op">=</span> <span class="st">"You"</span>, N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ds_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">ds1</span>, <span class="va">ds2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ds_full</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ds_full</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   plot observer n_obs Plot  obs  N
## 1    1       Me    10   NA &lt;NA&gt; NA
## 2    2       Me    86   NA &lt;NA&gt; NA
## 3    3       Me    47   NA &lt;NA&gt; NA
## 4    4       Me     5   NA &lt;NA&gt; NA
## 5    5       Me    92   NA &lt;NA&gt; NA
## 6    6       Me    32   NA &lt;NA&gt; NA</code></pre>
<p>We can also add more information with <code>bind_cols</code>, though joins (below) are usually a better way to add columns to a data set. <code>bind_cols</code> is also useful for creating new data frames from vectors:</p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">observers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Me"</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ds1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">plots</span>, observer <span class="op">=</span> <span class="va">observers</span>, n_obs <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="joins" class="section level3" number="9.4.2">
<h3>
<span class="header-section-number">9.4.2</span> Joins<a class="anchor" aria-label="anchor" href="#joins"><i class="fas fa-link"></i></a>
</h3>
<p>There are several types of join. The most common types are left join, inner join, or full join. To understand this terminology, consider this: whenever you are joining two tables, the first table you mention (the one to which you’re joining) is called the left table, whereas the second table (the one you’re joining to the first) is called the right table. With a left join, you keep all the records in the left table and add information from the right table whenever there’s a matching row. A full join means that you retain all rows from both tables, matching them whenever possible. An inner join means that you only retain the rows that match between the two tables.</p>
<p>Let’s practice with the Murray et al. data. First, we need to download some extra data to add. The EltonTraits database provides foraging attributes and body mass for birds and mammals. These might be interesting, for example to see if species’ responses to urbanization vary depending on their body size or foraging traits. These data can be downloaded from <a href="https://figshare.com/collections/EltonTraits_1_0_Species-level_foraging_attributes_of_the_world_s_birds_and_mammals/3306933">Figshare</a>.</p>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elton</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/raw/EltonTraits/BirdFuncDat.csv"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Rows: 10205 Columns: 40
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (17): SpecID, PassNonPass, IOCOrder, BLFamilyLatin, BLFamilyEnglish, Tax...
## dbl (23): BLFamSequID, Diet-Inv, Diet-Vend, Diet-Vect, Diet-Vfish, Diet-Vunk...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_birds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">urban_data</span>, <span class="va">host.class</span> <span class="op">==</span> <span class="st">"birds"</span><span class="op">)</span></span></code></pre></div>
<p>This can be a little tricky: EltonTraits and the Murray et al. database use different taxonomies, so there are a few birds in <code>urban_birds</code> that aren’t in EltonTraits. To really use these data we would need to correct those discrepancies, but for now this will help illustrate the different types of joins.</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Which birds are missing?</span></span>
<span><span class="va">urban_birds</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">host.species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">elton</span><span class="op">$</span><span class="va">Scientific</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">host.species</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 9 × 1
##   host.species     
##   &lt;chr&gt;            
## 1 Abrornis_inornata
## 2 Kieneria_aberti  
## 3 Kieneria_aberti  
## 4 Kieneria_aberti  
## 5 Kieneria_aberti  
## 6 Kieneria_aberti  
## 7 Kieneria_aberti  
## 8 Kieneria_aberti  
## 9 Kieneria_aberti</code></pre>
<p>Left joins are probably the most common type you will use, because they help add new information to a reference data set.</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">urban_birds</span>, <span class="va">elton</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host.species"</span> <span class="op">=</span> <span class="st">"Scientific"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">urban_birds</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 42</code></pre>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">urban_traits</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 81</code></pre>
<p>The <code>by</code> argument is the second-trickiest part of a join (the trickiest part is making sure it did what you expected). Here, we specify that we want to match up values in the column <code>host.species</code> from the first data frame with values in the column <code>Scientific</code> in the second data set. The <code>tidyverse</code> join functions will automatically use columns with the same names if you don’t specify <code>by</code>. If you specify a single character, it will look for columns with that name in both data sets. Finally, you can specify multiple columns (for example, if you had a study design with <code>block</code> nested within <code>plot</code> and you wanted to match both).</p>
<p>An inner join would be similar, but would eliminate those species that are not in EltonTraits, because they are not present in both data sets:</p>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">urban_birds</span>, <span class="va">elton</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host.species"</span> <span class="op">=</span> <span class="st">"Scientific"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">urban_birds</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 159</code></pre>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">urban_traits</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 150</code></pre>
<p>An full join would be helpful if you want to include all the effect sizes and all the trait information in a single data set, regardless of whether you have the other information:</p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">urban_birds</span>, <span class="va">elton</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"host.species"</span> <span class="op">=</span> <span class="st">"Scientific"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">urban_traits</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 81</code></pre>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">urban_traits</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 10334</code></pre>
</div>
</div>
<div id="pivoting-between-wide-and-long-format" class="section level2" number="9.5">
<h2>
<span class="header-section-number">9.5</span> Pivoting between wide and long format<a class="anchor" aria-label="anchor" href="#pivoting-between-wide-and-long-format"><i class="fas fa-link"></i></a>
</h2>
<p>We talked about wide and long formats when discussing data entry and spreadsheets, but it is still useful to know how to transform your data sets once they get into R. Why? Well, sometimes you will have a data set that isn’t set up in long form. Other times, wide form is useful for visualization or making tables.</p>
<div id="long-to-wide" class="section level3" number="9.5.1">
<h3>
<span class="header-section-number">9.5.1</span> Long to wide<a class="anchor" aria-label="anchor" href="#long-to-wide"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s start with a data set in long form: one observation per row, one variable per column. The urban wildlife data set follows this structure. Let’s say we want to know how many studies we have per year and health metric:</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">health</span>, <span class="va">YEAR</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'health'. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 54 × 3
## # Groups:   health [4]
##    health     YEAR     n
##    &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;
##  1 condition  1999     6
##  2 condition  2002     1
##  3 condition  2003     3
##  4 condition  2005     2
##  5 condition  2008     5
##  6 condition  2010    10
##  7 condition  2011     4
##  8 condition  2012    13
##  9 condition  2013     1
## 10 condition  2014     3
## # ℹ 44 more rows</code></pre>
<p>To present this in a paper, we might consider transforming it to wide form:</p>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">health</span>, <span class="va">YEAR</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">YEAR</span>, names_from <span class="op">=</span> <span class="va">health</span>, values_from <span class="op">=</span> <span class="va">n</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'health'. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 20 × 5
##     YEAR condition parasites stress toxicants
##    &lt;dbl&gt;     &lt;int&gt;     &lt;int&gt;  &lt;int&gt;     &lt;int&gt;
##  1  1999         6         0      0         0
##  2  2002         1         1      2         0
##  3  2003         3         1      0         5
##  4  2005         2         1      0         5
##  5  2008         5        13      4         4
##  6  2010        10         5      0        36
##  7  2011         4        44      4         0
##  8  2012        13        20     15        15
##  9  2013         1         6      8        18
## 10  2014         3        46      9         0
## 11  2016        11        26     12         7
## 12  2017         1         6      6        61
## 13  1998         0         3      0         0
## 14  2000         0         2      1         0
## 15  2001         0         1      0         0
## 16  2004         0        11      1         1
## 17  2006         0         1      0         0
## 18  2009         0         1      8         0
## 19  2015         0         6      2        27
## 20  2007         0         0      1        10</code></pre>
<p>Here we use the <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> function from the <code>tidyr</code> package (part of the <code>tidyverse</code>). Here <code>id_cols</code> tells the function which variable to use to define a row in the new table. <code>names_from</code> defines the column in the long-form data that will become the column names, and <code>values_from</code> defines the column in the long-form data that will be used to fill those columns. Finally, you don’t always need <code>values_fill</code>, but when an id-name combination is missing in the original data, this tells the funciton what to include in the new table (by default, it will be <code>NA</code>).</p>
<p>Pivoting data frames takes some practice. One of the most common pitfalls in going from wide to long form is that each id-name combination needs to have a unique value. For example, let’s say we first summarized the data by both year and host habitat:</p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">health</span>, <span class="va">YEAR</span>, <span class="va">aqterr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">YEAR</span>, names_from <span class="op">=</span> <span class="va">health</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'health', 'YEAR'. You can override using
## the `.groups` argument.</code></pre>
<pre><code>## Warning: Values from `n` are not uniquely identified; output will contain list-cols.
## • Use `values_fn = list` to suppress this warning.
## • Use `values_fn = {summary_fun}` to summarise duplicates.
## • Use the following dplyr code to identify duplicates.
##   {data} |&gt;
##   dplyr::summarise(n = dplyr::n(), .by = c(YEAR, health)) |&gt;
##   dplyr::filter(n &gt; 1L)</code></pre>
<pre><code>## # A tibble: 20 × 5
## # Groups:   YEAR [20]
##     YEAR condition parasites stress    toxicants
##    &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1  1999 &lt;int [1]&gt; &lt;NULL&gt;    &lt;NULL&gt;    &lt;NULL&gt;   
##  2  2002 &lt;int [1]&gt; &lt;int [1]&gt; &lt;int [1]&gt; &lt;NULL&gt;   
##  3  2003 &lt;int [1]&gt; &lt;int [1]&gt; &lt;NULL&gt;    &lt;int [1]&gt;
##  4  2005 &lt;int [1]&gt; &lt;int [1]&gt; &lt;NULL&gt;    &lt;int [1]&gt;
##  5  2008 &lt;int [1]&gt; &lt;int [1]&gt; &lt;int [1]&gt; &lt;int [1]&gt;
##  6  2010 &lt;int [2]&gt; &lt;int [1]&gt; &lt;NULL&gt;    &lt;int [2]&gt;
##  7  2011 &lt;int [1]&gt; &lt;int [1]&gt; &lt;int [1]&gt; &lt;NULL&gt;   
##  8  2012 &lt;int [2]&gt; &lt;int [1]&gt; &lt;int [2]&gt; &lt;int [2]&gt;
##  9  2013 &lt;int [1]&gt; &lt;int [1]&gt; &lt;int [2]&gt; &lt;int [1]&gt;
## 10  2014 &lt;int [2]&gt; &lt;int [2]&gt; &lt;int [1]&gt; &lt;NULL&gt;   
## 11  2016 &lt;int [2]&gt; &lt;int [2]&gt; &lt;int [2]&gt; &lt;int [1]&gt;
## 12  2017 &lt;int [1]&gt; &lt;int [1]&gt; &lt;int [1]&gt; &lt;int [2]&gt;
## 13  1998 &lt;NULL&gt;    &lt;int [1]&gt; &lt;NULL&gt;    &lt;NULL&gt;   
## 14  2000 &lt;NULL&gt;    &lt;int [1]&gt; &lt;int [1]&gt; &lt;NULL&gt;   
## 15  2001 &lt;NULL&gt;    &lt;int [1]&gt; &lt;NULL&gt;    &lt;NULL&gt;   
## 16  2004 &lt;NULL&gt;    &lt;int [2]&gt; &lt;int [1]&gt; &lt;int [1]&gt;
## 17  2006 &lt;NULL&gt;    &lt;int [1]&gt; &lt;NULL&gt;    &lt;NULL&gt;   
## 18  2009 &lt;NULL&gt;    &lt;int [1]&gt; &lt;int [1]&gt; &lt;NULL&gt;   
## 19  2015 &lt;NULL&gt;    &lt;int [1]&gt; &lt;int [1]&gt; &lt;int [1]&gt;
## 20  2007 &lt;NULL&gt;    &lt;NULL&gt;    &lt;int [1]&gt; &lt;int [2]&gt;</code></pre>
<p>You see this gave us a warning message and that the new columns are lists. This is because some of the cells in this wide data frame now have more than one element (i.e., years where both aquatic and terrestrial hosts had data for a given health metric). We can fix this by including <code>aqterr</code> as either and ID or a names column:</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">health</span>, <span class="va">YEAR</span>, <span class="va">aqterr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">YEAR</span>, <span class="va">aqterr</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">health</span>, values_from <span class="op">=</span> <span class="va">n</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'health', 'YEAR'. You can override using
## the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 6 × 6
## # Groups:   YEAR [6]
##    YEAR aqterr      condition parasites stress toxicants
##   &lt;dbl&gt; &lt;chr&gt;           &lt;int&gt;     &lt;int&gt;  &lt;int&gt;     &lt;int&gt;
## 1  1999 aquatic             6         0      0         0
## 2  2002 terrestrial         1         1      2         0
## 3  2003 terrestrial         3         1      0         5
## 4  2005 terrestrial         2         1      0         5
## 5  2008 terrestrial         5        13      4         0
## 6  2010 aquatic             8         0      0         6</code></pre>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urban_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">health</span>, <span class="va">YEAR</span>, <span class="va">aqterr</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">YEAR</span>, names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">health</span>, <span class="va">aqterr</span><span class="op">)</span>, values_from <span class="op">=</span> <span class="va">n</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'health', 'YEAR'. You can override using
## the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 6 × 9
## # Groups:   YEAR [6]
##    YEAR condition_aquatic condition_terrestrial parasites_terrestrial
##   &lt;dbl&gt;             &lt;int&gt;                 &lt;int&gt;                 &lt;int&gt;
## 1  1999                 6                     0                     0
## 2  2002                 0                     1                     1
## 3  2003                 0                     3                     1
## 4  2005                 0                     2                     1
## 5  2008                 0                     5                    13
## 6  2010                 8                     2                     5
## # ℹ 5 more variables: parasites_aquatic &lt;int&gt;, stress_aquatic &lt;int&gt;,
## #   stress_terrestrial &lt;int&gt;, toxicants_terrestrial &lt;int&gt;,
## #   toxicants_aquatic &lt;int&gt;</code></pre>
<p>In the second case, we end up with the health and habitat data being sandwiched together into new column names.</p>
</div>
<div id="wide-to-long" class="section level3" number="9.5.2">
<h3>
<span class="header-section-number">9.5.2</span> Wide to long<a class="anchor" aria-label="anchor" href="#wide-to-long"><i class="fas fa-link"></i></a>
</h3>
<p>In the other direction, we sometimes end up with data that is wide and needs to be long. For example, let’s say we have a data set with counts by site across years:</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">10</span><span class="op">*</span><span class="fl">12</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">10</span>, ncol <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"site"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2009</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">survey_data</span></span></code></pre></div>
<pre><code>##    year site1 site2 site3 site4 site5 site6 site7 site8 site9 site10 site11
## 1  2000    25    55    10    73    67    15    26    84    86     34     96
## 2  2001    75     9    40    28    74    70   100    28    59     59     80
## 3  2002    68    51    16    30    39    78    56    87    49      6     48
## 4  2003     5     8    25    25    83    72    44    82    63     92     20
## 5  2004    16    66     3    78    33     5    11   100    95     48     58
## 6  2005    13    80    64    21     7    97    94    29    35     71     96
## 7  2006    91    37    66    39    97    98    48    71    10     98     67
## 8  2007    88    78    29    57    98    49    85    45    50     97     20
## 9  2008    19    79    95    76    40     9    51    87     1     40     67
## 10 2009    94     8    18    31    54    64    85    80    65     53     58
##    site12
## 1      49
## 2       7
## 3      78
## 4      25
## 5      47
## 6      45
## 7       2
## 8      26
## 9      90
## 10      2</code></pre>
<p>(Side note: this is an example of how to simulate data to test code. We can go into this in more detail later in the course.)</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">year</span>, names_to <span class="op">=</span> <span class="st">"site"</span>, values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 120 × 3
##     year site   count
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt;
##  1  2000 site1     25
##  2  2000 site2     55
##  3  2000 site3     10
##  4  2000 site4     73
##  5  2000 site5     67
##  6  2000 site6     15
##  7  2000 site7     26
##  8  2000 site8     84
##  9  2000 site9     86
## 10  2000 site10    34
## # ℹ 110 more rows</code></pre>
<p>Here, we use the <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> function, also from <code>tidyr</code> and identify the columns that we want to pivot with <code>cols</code>. Because we want to get values from all the columns <em>except</em> the <code>year</code> column, we use a minus sign (-) to indicate that. We could also list all the columns (<code>c(site1, site2, site3)</code>), but this would be unwieldy. We also specify the column names of the new columns we are creating: one for what were the column names in the old wide data frame (<code>names_to</code>) and one for what were the values.</p>
<p>One common challenge with pivoting longer is when we have a data frame that has more columns than the ones we want to include in the long data. For example, let’s say our survey data also included information about the observer:</p>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">survey_data</span>, observer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">year</span>, names_to <span class="op">=</span> <span class="st">"site"</span>, values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Error in `pivot_longer()`:
## ! Can't combine `site1` &lt;integer&gt; and `observer` &lt;character&gt;.</code></pre>
<p>Here, we get an error because <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> is trying to make a single column (“count”) that includes both numbers and a character. We can get around this by removing the observer from the data before pivoting or, if we want that information, including it in our column specification:</p>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">observer</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">year</span>, names_to <span class="op">=</span> <span class="st">"site"</span>, values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##    year site  count
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1  2000 site1    25
## 2  2000 site2    55
## 3  2000 site3    10
## 4  2000 site4    73
## 5  2000 site5    67
## 6  2000 site6    15</code></pre>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">observer</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"site"</span>, values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## # A tibble: 120 × 4
##     year observer site   count
##    &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;int&gt;
##  1  2000 C        site1     25
##  2  2000 C        site2     55
##  3  2000 C        site3     10
##  4  2000 C        site4     73
##  5  2000 C        site5     67
##  6  2000 C        site6     15
##  7  2000 C        site7     26
##  8  2000 C        site8     84
##  9  2000 C        site9     86
## 10  2000 C        site10    34
## # ℹ 110 more rows</code></pre>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="lubridate.html"><span class="header-section-number">8</span> Dates and Times in R</a></div>
<div class="next"><a href="style.html"><span class="header-section-number">10</span> Coding Best Practices</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#manipulation"><span class="header-section-number">9</span> Data Manipulation with R, Part 2</a></li>
<li><a class="nav-link" href="#objectives-6"><span class="header-section-number">9.1</span> Objectives</a></li>
<li><a class="nav-link" href="#additional-reading-6"><span class="header-section-number">9.2</span> Additional reading</a></li>
<li><a class="nav-link" href="#grouping-and-summarizing-data"><span class="header-section-number">9.3</span> Grouping and summarizing data</a></li>
<li>
<a class="nav-link" href="#combining-and-augmenting-data-sets"><span class="header-section-number">9.4</span> Combining and augmenting data sets</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#binding-rows-and-columns"><span class="header-section-number">9.4.1</span> Binding rows and columns</a></li>
<li><a class="nav-link" href="#joins"><span class="header-section-number">9.4.2</span> Joins</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#pivoting-between-wide-and-long-format"><span class="header-section-number">9.5</span> Pivoting between wide and long format</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#long-to-wide"><span class="header-section-number">9.5.1</span> Long to wide</a></li>
<li><a class="nav-link" href="#wide-to-long"><span class="header-section-number">9.5.2</span> Wide to long</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Management and Reproducible Science</strong>" was written by Claire S Teitelbaum. It was last built on 2025-11-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
